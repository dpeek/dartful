<html>
<head>
  <title>Dartful - Setup and Research</title>
  <link href='../../../styles.css' rel='stylesheet' type='text/css'>
  <link rel="shortcut icon" href="favicon.ico">
</head>
<body>
  <div id='content'>
    <header id='banner'>
      <h1>Dartful</h1>
    </header>
    <article>
      <header>
        <h1>Setup and Research</h1>
        <span>Monday, 18 February 2013</span>
      </header>
      <div><p>The <a href="http://www.dartlang.org/downloads.html">installation instructions</a> on the Dart website are great, and 
since I didn't have any issues I don't have much to add. In no time at all I 
was skimming through tutorials, playing with futures from dart:async and 
writing my first HelloWorld HttpServer with Rikulo. Rikulo introduced the idea 
of a project <code>build.dart</code> where I could define build tasks, A good place to 
start roughing out the pieces of the blog engine.</p>
<p>The build script is executed when files in your project change, and can also 
be configured using the option parsing library from the Dart Team. This should 
allow me to define some tasks for creating pages and posts, previewing and 
publishing the site. Initially I'll focus on publishing.</p>
<p>Here's what publishing needs to do (pseudo code):</p>
<pre><span class="k ">class</span> <span class="t ">Post</span> <span class="p ">{</span><span class="c">
  // post model
</span><span class="p ">}</span>

<span class="t ">void</span> <span class="i ">main</span><span class="p ">(</span><span class="p ">)</span> <span class="p ">{</span>
  <span class="k ">var</span> <span class="i ">files</span> <span class="o ">=</span> <span class="i ">getMarkdownFiles</span><span class="p ">(</span><span class="p ">)</span><span class="p ">;</span>
  <span class="k ">var</span> <span class="i ">posts</span> <span class="o ">=</span> <span class="i ">paths</span><span class="p ">.</span><span class="i ">map</span><span class="p ">(</span><span class="i ">readPost</span><span class="p ">)</span><span class="p ">;</span>
  <span class="i ">writeIndex</span><span class="p ">(</span><span class="i ">posts</span><span class="p ">)</span><span class="p ">;</span>
  <span class="i ">posts</span><span class="p ">.</span><span class="i ">forEach</span><span class="p ">(</span><span class="i ">writePost</span><span class="p ">)</span><span class="p ">;</span>
<span class="p ">}</span>

<span class="t ">List</span><span class="o ">&lt;</span><span class="t ">File</span><span class="o ">&gt;</span> <span class="i ">getMarkdownFiles</span><span class="p ">(</span><span class="p ">)</span> <span class="p ">{</span><span class="c">
  // get markdown files
</span><span class="p ">}</span>

<span class="t ">Post</span> <span class="i ">readPost</span><span class="p ">(</span><span class="t ">File</span> <span class="i ">file</span><span class="p ">)</span> <span class="p ">{</span><span class="c">
  // read file
  // parse haml
  </span><span class="k ">return</span> <span class="i ">post</span><span class="p ">;</span>
<span class="p ">}</span>

<span class="t ">void</span> <span class="i ">writeIndex</span><span class="p ">(</span><span class="t ">List</span><span class="o ">&lt;</span><span class="t ">Post</span><span class="o ">&gt;</span> <span class="i ">posts</span><span class="p ">)</span> <span class="p ">{</span><span class="c">
  // markdown to html
  // write file
</span><span class="p ">}</span>

<span class="t ">void</span> <span class="i ">writePost</span><span class="p ">(</span><span class="t ">Post</span> <span class="i ">post</span><span class="p ">)</span> <span class="p ">{</span><span class="c">
  // markdown to html
  // write file
</span><span class="p ">}</span></pre>
<h2>Markdown</h2>
<p>Most of the work involved parsing Markdown and converting it to HTML. Dartdoc, 
a documentation tool that ships with the SDK, includes an approachable parser 
and HTML renderer. Unfortunately, using it outside of Dartdoc took some work.</p>
<p>I found another project using the parser on GitHub where it was referenced 
using a <code>sdk:dartdoc</code> pubspec dependency. This no longer works as Dartdoc has 
been moved from <code>dart-sdk/pkg</code> to <code>dark-sdk/lib/_internal</code>. I eventually found 
a workaround by copying <code>_private</code> to my project. I've asked for a better 
solution on the [mailing list][mailing].</p>
<p>I can now parse Markdown like a boss:</p>
<pre><span class="k ">import</span> <span class="s si">'_internal/dartdoc/lib/markdown.dart'</span><span class="p ">;</span>

<span class="t ">void</span> <span class="i ">main</span><span class="p ">(</span><span class="p ">)</span> <span class="p ">{</span>
  <span class="i ">print</span><span class="p ">(</span><span class="i ">markdownToHtml</span><span class="p ">(</span><span class="s si">"Hello *World*"</span><span class="p ">)</span><span class="p ">)</span><span class="p ">;</span>
<span class="p ">}</span></pre>
<h2>YAML</h2>
<p>The <a href="http://pub.dartlang.org/packages/yaml">YAML</a> library used to parse pubspec files does what is says on the 
box, parsing a document into a stream of key/value pairs. In this case it will 
be easier to create a lookup:</p>
<pre><span class="t ">void</span> <span class="i ">main</span><span class="p ">(</span><span class="p ">)</span> <span class="p ">{</span>
  <span class="k ">var</span> <span class="i ">values</span> <span class="o ">=</span> <span class="k ">new</span> <span class="t ">Map</span><span class="p ">(</span><span class="p ">)</span><span class="p ">;</span>
  <span class="i ">loadYaml</span><span class="p ">(</span><span class="s si">'foo: 10'</span><span class="p ">)</span><span class="p ">.</span><span class="i ">forEach</span><span class="p ">(</span><span class="p ">(</span><span class="i ">k</span><span class="p ">,</span> <span class="i ">v</span><span class="p ">)</span> <span class="a ">=&gt;</span> <span class="i ">values</span><span class="p ">[</span><span class="i ">k</span><span class=" ">]</span> <span class="o ">=</span> <span class="i ">v</span><span class="p ">)</span><span class="p ">;</span>
  <span class="i ">print</span><span class="p ">(</span><span class="i ">values</span><span class="p ">[</span><span class="i ">foo</span><span class=" ">]</span><span class="p ">)</span><span class="p ">;</span>
<span class="p ">}</span></pre>
<h2>Templates</h2>
<p>It seems like the Dart team has <a href="https://groups.google.com/a/dartlang.org/forum/?fromgroups=#!topic/misc/o8SWaMrjDgA">plans for templates</a>. I did 
investigate the <a href="http://blog.sethladd.com/2012/03/first-look-at-darts-html-template.html">template library</a> in the bleeding edge branch, but 
it seems to have fallen behind changes to the core libraries and language. I 
also checked out <a href="http://pub.dartlang.org/packages/hart">hart</a> but it seems like the wrong solution for what 
should be fairly simple page templates. For now I'll stick with hard coded 
templates until the basics are finished.</p></div>
    </article>
  </div>
</body>
</html>